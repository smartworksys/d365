// Async function to get the product by product code
async function getProductByCodeAsync(productCode) {
    try {
        // Ensure proper single quotes and formatting in the query
        var query = `/api/data/v9.0/nfc_otdb_products?$select=nfc_otdb_productid,nfc_otdb_name&$filter=nfc_otbd_ProductCode eq '${encodeURIComponent(productCode)}'`;
        
        var result = await Xrm.WebApi.retrieveMultipleRecords("nfc_otdb_product", query);
        
        if (result.entities.length > 0) {
            return {
                id: result.entities[0].nfc_otdb_productid, // Product GUID
                name: result.entities[0].nfc_otdb_name, // Product Name
                entityType: "nfc_otdb_product" // Product Entity Type
            };
        } else {
            console.log("No product found for the provided product code.");
            return null;
        }
    } catch (error) {
        console.log("Error retrieving product: " + error.message);
        return null;
    }
}

// Function to set the default value of the product lookup
async function setProductLookupDefaultValue(formContext, productCode, lookupFieldName) {
    var product = await getProductByCodeAsync(productCode);
    
    if (product) {
        formContext.getAttribute(lookupFieldName).setValue([product]);
        console.log("Default product lookup value set.");
    } else {
        console.log("Failed to set the default product lookup value.");
    }
}
