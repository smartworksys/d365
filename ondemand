function validateFieldsOnSave(executionContext) {
    var formContext = executionContext.getFormContext();
    var saveEvent = executionContext.getEventArgs();
    saveEvent.preventDefault(); // Always prevent default to control the flow explicitly.

    var certificateAccountNumber = formContext.getAttribute(CONSTANTS.ATTRIBUTE_NAMES.CERTIFICATE_ACCOUNT_NUMBER).getValue();
    var affiliateAccountNumber = formContext.getAttribute(CONSTANTS.ATTRIBUTE_NAMES.AFFILIATE_ACCOUNT_NUMBER).getValue();

    if (!certificateAccountNumber) {
        Xrm.Navigation.openAlertDialog({ text: formatString(CONSTANTS.MESSAGES.REQUIRED_FIELD, "Certificate Account Number") });
        return;
    }
    if (!affiliateAccountNumber) {
        Xrm.Navigation.openAlertDialog({ text: formatString(CONSTANTS.MESSAGES.REQUIRED_FIELD, "Affiliate Account Number") });
        return;
    }

    // Only proceed with confirmation if manual review is required
    var manualReview = formContext.getAttribute(CONSTANTS.ATTRIBUTE_NAMES.MANUAL_REVIEW).getValue();
    if (manualReview) {
        var confirmOptions = {
            title: "Confirmation Required",
            text: CONSTANTS.MESSAGES.MANUAL_REVIEW_CONFIRMATION
        };

        Xrm.Navigation.openConfirmDialog(confirmOptions).then(function (result) {
            if (result.confirmed) {
                // Decide what type of save based on the mode after confirmation
                var saveMode = saveEvent.getSaveMode();
                if (saveMode === 1 || saveMode === 70) { // Normal save or autosave
                    formContext.data.save();
                } else if (saveMode === 2) { // Save and close
                    formContext.data.save("saveandclose");
                }
            } else {
                console.log("Save canceled by user.");
            }
        }).catch(function (error) {
            console.log("Error in confirmation dialog: " + error);
        });
    } else {
        // If no manual review is required, proceed to save normally.
        // Optionally, you might want to handle different save modes here as well.
    }
}
