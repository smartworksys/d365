<!DOCTYPE html>
<html>
<head>
    <title>Dropdown Population</title>
    <script type="text/javascript">
        var formContext;

        // Function to populate dropdown with data from parent form
        function populateDropdown(data) {
            var dropdown = document.getElementById("myDropdown");
            dropdown.innerHTML = ""; // Clear existing options
            dropdown.add(new Option("Select an option", "", true, true)); // Add default option
            data.forEach(function(item) {
                var option = document.createElement("option");
                option.text = item.name;
                option.value = item.id;
                dropdown.add(option);
            });
        }

        // Function to receive formContext from the parent D365 form
        function receiveDataFromParent(context) {
            formContext = context.formContext; // Extract formContext
            var selectedData = context.data;   // Extract data for dropdown
            populateDropdown(selectedData);
        }

        // Function to send the selected dropdown value to the parent form
        function sendValueToParentForm() {
            var dropdown = document.getElementById("myDropdown");
            var selectedValue = dropdown.options[dropdown.selectedIndex].value;

            // Check if a valid selection was made
            if (!selectedValue) {
                alert("Please select a valid option from the dropdown.");
                return; // Prevent action if no valid selection
            }

            // If valid selection, send value to parent form using formContext
            if (formContext) {
                var targetField = "targetField";  // Replace with actual field schema name
                formContext.getAttribute(targetField).setValue(selectedValue);
            } else {
                console.error("Form context not found.");
            }
        }
    </script>
</head>
<body>
    <!-- Dropdown with onchange event to send value to parent on change -->
    <select id="myDropdown" onchange="sendValueToParentForm()">
        <option value="" disabled selected>Select an option</option>
    </select>
</body>
</html>


function onFieldChange(executionContext) {
    var formContext = executionContext.getFormContext();

    // Example data to populate the dropdown (you can replace this with an API call if needed)
    var data = [
        { id: "1", name: "Option 1" },
        { id: "2", name: "Option 2" },
        { id: "3", name: "Option 3" }
    ];

    // Get the HTML web resource control
    var webResourceControl = formContext.getControl("WebResource_controlname");
    
    if (webResourceControl !== null) {
        var webResourceWindow = webResourceControl.getContentWindow();

        webResourceWindow.then(function(window) {
            // Pass formContext and data to the HTML web resource
            window.receiveDataFromParent({
                formContext: formContext, 
                data: data
            });
        });
    }
}
