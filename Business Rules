function validateFedTaxPercent(executionContext) {
    const formContext = executionContext.getFormContext();
    const fieldName = "nf1pbm_irafedtaxpercent";
    const value = formContext.getAttribute(fieldName).getValue();

    if (value != null && (value < 0 || value > 100)) {
        formContext.getControl(fieldName).setNotification("Please enter a value between 0 and 100", "fedtax_range_error");

        Xrm.Navigation.openAlertDialog({
            text: "Federal Tax Percent must be between 0 and 100.",
            title: "Invalid Input"
        });

        return false;
    } else {
        formContext.getControl(fieldName).clearNotification("fedtax_range_error");
        return true;
    }
}

function validateStTaxPercent(executionContext) {
    const formContext = executionContext.getFormContext();
    const fieldName = "nf1pbm_irasttaxpercent";
    const value = formContext.getAttribute(fieldName).getValue();

    if (value != null && (value < 0 || value > 100)) {
        formContext.getControl(fieldName).setNotification("Please enter a value between 0 and 100", "sttax_range_error");

        Xrm.Navigation.openAlertDialog({
            text: "State Tax Percent must be between 0 and 100.",
            title: "Invalid Input"
        });

        return false;
    } else {
        formContext.getControl(fieldName).clearNotification("sttax_range_error");
        return true;
    }
}

function onSaveValidation(executionContext) {
    const isFedValid = validateFedTaxPercent(executionContext);
    const isStValid = validateStTaxPercent(executionContext);

    if (!isFedValid || !isStValid) {
        const eventArgs = executionContext.getEventArgs();
        eventArgs.preventDefault(); // Cancel the save
    }
}

 formContext.data.setFormDirty(false);

function discardChangesAndNavigate(formContext) {
    // Set all attributes to not submit changes
    formContext.data.entity.attributes.forEach(function (attribute) {
        attribute.setSubmitMode("never");
    });

    // Navigate to the desired page
    var pageInput = {
        pageType: "entitylist",
        entityName: formContext.data.entity.getEntityName()
    };
    Xrm.Navigation.navigateTo(pageInput, { target: 1 });
}

