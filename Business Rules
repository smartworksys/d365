function onFormLoad(executionContext) {
    const formContext = executionContext.getFormContext();
    handleIRAClosureLogic(formContext);
    formContext.getAttribute("amount_to").addOnChange(() => handleIRAClosureLogic(formContext));
    formContext.getAttribute("state_withholding").addOnChange(() => validateStateWithholding(formContext));
}

function handleIRAClosureLogic(formContext) {
    const amountTo = formContext.getAttribute("amount_to")?.getValue();
    const reqdPlCls = formContext.getAttribute("reqd_pl_cls")?.getValue();

    if ((reqdPlCls === 'R' || reqdPlCls === 'Y') && amountTo === 'Close') {
        // Show Yes/No field and message
        const iraField = formContext.getControl("ira_plan_closure");
        iraField.setVisible(true);
        iraField.setNotification("Is this distribution part of an IRA Plan closure?");
    } else {
        const iraField = formContext.getControl("ira_plan_closure");
        iraField.setVisible(false);
        iraField.clearNotification();
    }
}

function validateStateWithholding(formContext) {
    const reqdPlCls = formContext.getAttribute("reqd_pl_cls")?.getValue();
    const regType = formContext.getAttribute("reg_type")?.getValue();
    const raCode = formContext.getAttribute("ra_code")?.getValue();
    const withholding = formContext.getAttribute("state_withholding")?.getValue();
    const iraPlanClosure = formContext.getAttribute("ira_plan_closure")?.getValue();

    // Assuming MIN_RATE is retrieved from a config or based on state
    const MIN_RATE = 10; // Example: 10%
    const isRegMatch = ['M', 'S', 'V'].includes(regType);
    const isRACodeMatch = ['Normal Withdrawal', 'Pre Mature Withdrawal'].includes(raCode);
    const isIRASelected = iraPlanClosure === true;

    if (isRegMatch && isRACodeMatch && isIRASelected && withholding < MIN_RATE) {
        if (reqdPlCls === 'R') {
            formContext.getControl("state_withholding").setNotification(
                `State Withholding must be ${MIN_RATE}% or higher. State taxes are mandated for plan closures, without the ability to exempt out.`
            );
        } else if (reqdPlCls === 'Y') {
            formContext.getControl("state_withholding").setNotification(
                `State Withholding must be ${MIN_RATE}% or higher. State taxes are mandated for plan closures, or 0.00% must be entered and an exemption form or signature must be received.`
            );
        }
    } else {
        formContext.getControl("state_withholding").clearNotification();
    }
}
